services:
  bgpalerter:
    image: nttgin/bgpalerter:latest
    container_name: bgpalerter
    restart: unless-stopped

    # Expose the REST API port for health checks
    ports:
      - "127.0.0.1:8011:8011"

    volumes:
      # Configuration files (read-only)
      - ./config/config.yml:/opt/bgpalerter/config.yml:ro
      - ./config/prefixes.yml:/opt/bgpalerter/prefixes.yml:ro
      - ./config/groups.yml:/opt/bgpalerter/groups.yml:ro
      
      # Logs directory (read-write so BGPalerter can write logs)
      - ./logs:/opt/bgpalerter/logs
      
      # Cache directory for persistent status (prevents duplicate alerts after restart)
      - ./cache:/opt/bgpalerter/.cache

    # Health check configuration
    healthcheck:
      test: ["CMD-SHELL", "wget --quiet --tries=1 --spider http://127.0.0.1:8011/status || exit 1"]
      interval: 60s
      timeout: 5s
      retries: 3
      start_period: 30s

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5""
