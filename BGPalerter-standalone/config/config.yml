# BGPalerter v2 Configuration File - Corrected for AS58173
configVersion: 2
environment: production

# Data sources for BGP updates
connectors:
  - file: connectorRIS
    name: ris
    params:
      url: ws://ris-live.ripe.net/v1/ws/
      perMessageDeflate: true
      carefulSubscription: true
      includeRaw: false
      subscription:
        type: UPDATE
        moreSpecific: true

# Monitoring modules
monitors:
  - file: monitorHijack
    channel: hijack
    name: basic-hijack-detection
    params:
      thresholdMinPeers: 3

  - file: monitorNewPrefix
    channel: newprefix
    name: new-prefix-detection
    params:
      thresholdMinPeers: 3

  - file: monitorVisibility
    channel: visibility
    name: withdrawal-detection
    params:
      thresholdMinPeers: 40

  - file: monitorPath
    channel: path
    name: path-matching
    params:
      thresholdMinPeers: 1

  - file: monitorAS
    channel: misconfiguration
    name: asn-monitor
    params:
      thresholdMinPeers: 3
      skipPrefixMatch: false

  - file: monitorRPKI
    channel: rpki
    name: rpki-monitor
    params:
      thresholdMinPeers: 3
      checkUncovered: false
      checkDisappearing: false

  - file: monitorROAS
    channel: roa
    name: rpki-diff
    params:
      enableDiffAlerts: true
      enableExpirationAlerts: true
      roaExpirationAlertHours: 24

  # ADDED: Upstream path neighbor monitoring
  - file: monitorPathNeighbors
    channel: path
    name: path-neighbors
    params:
      thresholdMinPeers: 3

# Reporting modules
reports:
  - file: reportFile
    channels: [hijack, newprefix, visibility, path, misconfiguration, rpki, roa]
    params:
      persistAlertData: false
      alertDataDirectory: alertdata/

  - file: reportEmail
    channels: [hijack, newprefix, visibility, path, misconfiguration, rpki, roa]
    params:
      senderEmail: "bgpalerter@onwave.com"
      smtp:
        host: "onwave-com.mail.protection.outlook.com"
        port: 25
        secure: false
      notifiedEmails:
        default:
          - "iain.murdoch@onwave.com"

  # Syslog reporter for heartbeats and operational logs to Alerta
  - file: reportSyslog
    channels: [hijack, newprefix, visibility, path, misconfiguration, rpki, roa]
    params:
      host: "localhost"
      port: 514
      transport: udp
      templates:
        default: "BGPalerter Heartbeat: ${type} - ${summary} | Prefix=${prefix} | ASN=${asn} | Channel=${channel}"
        hijack: "BGPalerter Alert [HIJACK]: ${type} - ${summary} | Prefix=${prefix} | Description=${description}"
        newprefix: "BGPalerter Alert [NEW_PREFIX]: ${type} - ${summary} | Prefix=${prefix} | Description=${description}"
        visibility: "BGPalerter Alert [VISIBILITY]: ${type} - ${summary} | Prefix=${prefix} | Peers=${peers}"
        path: "BGPalerter Alert [PATH]: ${type} - ${summary} | Prefix=${prefix} | Path=${path}"
        misconfiguration: "BGPalerter Alert [MISCONFIGURATION]: ${type} - ${summary} | Prefix=${prefix} | ASN=${asn}"
        rpki: "BGPalerter Alert [RPKI]: ${type} - ${summary} | Prefix=${prefix} | Status=${status}"
        roa: "BGPalerter Alert [ROA]: ${type} - ${summary} | Prefix=${prefix} | Description=${description}"

# Files for prefixes and groups
monitoredPrefixesFiles:
  - prefixes.yml

groupsFile: groups.yml

# RPKI validation settings
rpki:
  vrpProvider: rpkiclient
  refreshVrpListMinutes: 15
  markDataAsStaleAfterMinutes: 120

# REST API for health checks
rest:
  host: 0.0.0.0
  port: 8011

# Process monitoring for health checks
processMonitors:
  - file: uptimeApi
    params:
      useStatusCodes: true

# Logging settings
logging:
  directory: logs
  logRotatePattern: YYYY-MM-DD
  maxRetainedFiles: 10
  maxFileSizeMB: 15
  compressOnRotation: false
  useUTC: true

# Advanced settings
notificationIntervalSeconds: 86400
persistStatus: true
checkForUpdatesAtBoot: true

